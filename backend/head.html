<!-- backend/head.html -->
<section class="lg-head" aria-label="Team">
  <div class="lg-head__inner">
    <!-- Left: ruhiger Textbereich (kein Branding-Block, kein Button) -->
    <div class="lg-head__left">
      <h1 class="lg-head__title">Persönlich. Zuverlässig. Unkompliziert.</h1>
      <p class="lg-head__lead">
        Wir kümmern uns um die Details, damit euer Event entspannt bleibt.
        Von der Beratung bis zur Abholung: klar, schnell und mit einem Auge fürs Schöne.
      </p>
      <p class="lg-head__hint">Lernt unser Team kennen.</p>

      <!-- Detail-Panel (öffnet beim Klick auf Team-Mitglied) -->
      <div class="lg-head__detail" id="teamDetail" hidden>
        <div class="lg-head__detailHead">
          <div class="lg-head__detailAvatarWrap">
            <img id="teamDetailImg" class="lg-head__detailAvatar" alt="" />
          </div>
          <div class="lg-head__detailMeta">
            <div id="teamDetailName" class="lg-head__detailName"></div>
            <div id="teamDetailPos" class="lg-head__detailPos"></div>
          </div>
        </div>
        <div id="teamDetailText" class="lg-head__detailText"></div>
      </div>
    </div>

    <!-- Right: Team Grid -->
    <div class="lg-head__right" aria-label="Team-Mitglieder">
      <div class="lg-head__grid" id="teamGrid">
        <!-- Cards werden per JS geladen -->
      </div>

      <!-- Fallback -->
      <div class="lg-head__empty" id="teamEmpty" hidden>
        Team-Daten konnten nicht geladen werden.
      </div>
    </div>
  </div>
</section>

<style>
  /* ===== Head Layout (modern, schlicht, stilvoll) ===== */
  .lg-head{
    width:100%;
    min-height:100%;
    display:flex;
    align-items:stretch;
  }

  .lg-head__inner{
    width:100%;
    height:100%;
    display:grid;
    grid-template-columns: 0.9fr 1.1fr;
    gap: clamp(18px, 3vw, 40px);
    padding: clamp(18px, 3.2vw, 44px);
    border-radius: var(--radius, 14px);
    background: var(--card, #f8f9fb);
    box-shadow: var(--shadow, 0 10px 28px rgba(0,0,0,.08));
    overflow:hidden;
  }

  .lg-head__left{
    display:flex;
    flex-direction:column;
    justify-content:center;
    gap: 14px;
    padding: clamp(8px, 1.5vw, 18px);
  }

  .lg-head__title{
    margin:0;
    font-size: clamp(26px, 3.2vw, 44px);
    line-height: 1.05;
    letter-spacing: -0.02em;
    color: var(--text, #0f172a);
  }

  .lg-head__lead{
    margin:0;
    font-size: clamp(14px, 1.1vw, 16px);
    line-height: 1.55;
    color: rgba(15, 23, 42, 0.78);
    max-width: 48ch;
  }

  .lg-head__hint{
    margin: 2px 0 0 0;
    font-size: 13px;
    color: rgba(15, 23, 42, 0.55);
  }

  /* Detail Panel (links) */
  .lg-head__detail{
    margin-top: 12px;
    padding: 16px 16px 14px;
    border-radius: calc(var(--radius, 14px) - 2px);
    background: rgba(255,255,255,0.7);
    border: 1px solid rgba(15,23,42,0.06);
    box-shadow: 0 12px 28px rgba(0,0,0,0.06);
    backdrop-filter: blur(10px);
  }

  .lg-head__detailHead{
    display:flex;
    align-items:center;
    gap: 12px;
    margin-bottom: 10px;
  }

  .lg-head__detailAvatarWrap{
    width: 54px;
    height: 54px;
    border-radius: 16px;
    overflow:hidden;
    background:#e9eef7;
    flex: 0 0 auto;
  }

  .lg-head__detailAvatar{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  .lg-head__detailMeta{
    display:flex;
    flex-direction:column;
    gap: 2px;
    min-width:0;
  }

  .lg-head__detailName{
    font-weight: 700;
    color: var(--text, #0f172a);
    letter-spacing: -0.01em;
    font-size: 16px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .lg-head__detailPos{
    font-size: 12px;
    color: rgba(15,23,42,0.55);
  }

  .lg-head__detailText{
    font-size: 13px;
    line-height: 1.6;
    color: rgba(15, 23, 42, 0.78);
    white-space: pre-wrap;
  }

  .lg-head__right{
    display:flex;
    flex-direction:column;
    justify-content:center;
    min-width:0;
  }

  .lg-head__grid{
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 12px;
    max-height: 72vh;          /* bleibt im Head */
    overflow:auto;             /* mehr Team-Mitglieder ohne Buttons */
    padding-right: 6px;        /* Platz für Scrollbar */
  }

  .lg-head__grid::-webkit-scrollbar{ width: 10px; }
  .lg-head__grid::-webkit-scrollbar-track{ background: transparent; }
  .lg-head__grid::-webkit-scrollbar-thumb{
    background: rgba(15,23,42,0.12);
    border-radius: 999px;
    border: 3px solid transparent;
    background-clip: padding-box;
  }

  .team-card{
    display:flex;
    gap: 10px;
    align-items:center;
    padding: 12px;
    border-radius: calc(var(--radius, 14px) - 2px);
    background: rgba(255,255,255,0.78);
    border: 1px solid rgba(15,23,42,0.06);
    box-shadow: 0 10px 22px rgba(0,0,0,0.05);
    cursor:pointer;
    transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
    min-width:0;
  }

  .team-card:hover{
    transform: translateY(-2px);
    border-color: rgba(31,79,163,0.18);
    box-shadow: 0 14px 28px rgba(0,0,0,0.08);
  }

  .team-card__avatar{
    width: 44px;
    height: 44px;
    border-radius: 14px;
    overflow:hidden;
    background:#e9eef7;
    flex: 0 0 auto;
  }

  .team-card__avatar img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  .team-card__body{
    min-width:0;
    display:flex;
    flex-direction:column;
    gap: 3px;
  }

  .team-card__name{
    font-weight: 700;
    color: var(--text, #0f172a);
    letter-spacing: -0.01em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .team-card__snippet{
    font-size: 12px;
    line-height: 1.35;
    color: rgba(15,23,42,0.62);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow:hidden;
  }

  .lg-head__empty{
    padding: 14px;
    border-radius: calc(var(--radius, 14px) - 2px);
    background: rgba(255,255,255,0.75);
    border: 1px solid rgba(15,23,42,0.06);
    color: rgba(15,23,42,0.7);
    font-size: 13px;
  }

  /* Responsive */
  @media (max-width: 980px){
    .lg-head__inner{
      grid-template-columns: 1fr;
      gap: 18px;
    }
    .lg-head__grid{
      grid-template-columns: repeat(2, minmax(0, 1fr));
      max-height: 46vh;
    }
  }

  @media (max-width: 560px){
    .lg-head__grid{ grid-template-columns: 1fr; }
  }
</style>

<script>
  (function(){
    const MANIFEST_URL = "Team/manifest.json";

    const grid = document.getElementById("teamGrid");
    const empty = document.getElementById("teamEmpty");

    const detailWrap = document.getElementById("teamDetail");
    const detailImg  = document.getElementById("teamDetailImg");
    const detailName = document.getElementById("teamDetailName");
    const detailPos  = document.getElementById("teamDetailPos");
    const detailText = document.getElementById("teamDetailText");

    function parseFolder(folder){
      // Erwartet: Name_Position (Position optional)
      const parts = String(folder).split("_");
      let pos = null;

      if (parts.length > 1) {
        const last = parts[parts.length - 1];
        const n = Number(last);
        if (Number.isFinite(n)) {
          pos = n;
          parts.pop();
        }
      }

      const name = parts.join(" ").trim() || folder;
      return { name, pos };
    }

    function snippetFromText(txt){
      const s = (txt || "").trim().replace(/\s+/g, " ");
      if (!s) return "—";
      return s.length > 140 ? s.slice(0, 140).trim() + "…" : s;
    }

    async function safeFetchText(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error("Fetch failed: " + url);
      return await r.text();
    }

    function setDetail(member){
      detailName.textContent = member.name;
      detailPos.textContent = member.pos ? ("Position: " + member.pos) : "";
      detailText.textContent = (member.text || "").trim();
      detailImg.src = member.img;
      detailImg.alt = member.name;
      detailWrap.hidden = false;
    }

    function cardEl(member){
      const card = document.createElement("div");
      card.className = "team-card";
      card.tabIndex = 0;
      card.setAttribute("role", "button");
      card.setAttribute("aria-label", "Teammitglied: " + member.name);

      const avatar = document.createElement("div");
      avatar.className = "team-card__avatar";

      const img = document.createElement("img");
      img.loading = "lazy";
      img.src = member.img;
      img.alt = member.name;

      // Fallback: wenn Bild fehlt, lässt Browser broken img – wir ersetzen mit Initialen
      img.onerror = () => {
        avatar.innerHTML = "";
        const fallback = document.createElement("div");
        fallback.style.width = "100%";
        fallback.style.height = "100%";
        fallback.style.display = "grid";
        fallback.style.placeItems = "center";
        fallback.style.fontWeight = "800";
        fallback.style.color = "rgba(15,23,42,0.65)";
        fallback.style.background = "#e9eef7";
        fallback.textContent = member.name.split(" ").map(w => w[0]).slice(0,2).join("").toUpperCase();
        avatar.appendChild(fallback);
      };

      avatar.appendChild(img);

      const body = document.createElement("div");
      body.className = "team-card__body";

      const name = document.createElement("div");
      name.className = "team-card__name";
      name.textContent = member.name;

      const snip = document.createElement("div");
      snip.className = "team-card__snippet";
      snip.textContent = snippetFromText(member.text);

      body.appendChild(name);
      body.appendChild(snip);

      card.appendChild(avatar);
      card.appendChild(body);

      const open = () => setDetail(member);
      card.addEventListener("click", open);
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") { e.preventDefault(); open(); }
      });

      return card;
    }

    async function loadTeam(){
      try{
        const r = await fetch(MANIFEST_URL, { cache: "no-store" });
        if (!r.ok) throw new Error("Manifest missing");
        const manifest = await r.json();

        const folders = (manifest && Array.isArray(manifest.members))
          ? manifest.members.map(m => m.folder).filter(Boolean)
          : [];

        if (!folders.length) throw new Error("No members");

        const members = await Promise.all(folders.map(async (folder) => {
          const meta = parseFolder(folder);
          const base = "Team/" + folder + "/";
          const img  = base + "image.png";
          const txt  = base + "team.txt";

          let text = "";
          try { text = await safeFetchText(txt); } catch(e){ text = ""; }

          return {
            folder,
            name: meta.name,
            pos: meta.pos,
            img,
            text
          };
        }));

        // Sortierung nach pos, ansonsten ans Ende, dann Name
        members.sort((a,b) => {
          const ap = (a.pos == null) ? 9999 : a.pos;
          const bp = (b.pos == null) ? 9999 : b.pos;
          if (ap !== bp) return ap - bp;
          return a.name.localeCompare(b.name, "de");
        });

        grid.innerHTML = "";
        members.forEach(m => grid.appendChild(cardEl(m)));

        // Detail initial: erstes Element
        setDetail(members[0]);

        empty.hidden = true;
      }catch(err){
        empty.hidden = false;
        grid.innerHTML = "";
        detailWrap.hidden = true;
      }
    }

    loadTeam();
  })();
</script>
