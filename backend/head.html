<!-- backend/head.html -->
<section class="team-head" aria-label="Team">
  <div class="team-head__bg" id="teamBg" aria-hidden="true"></div>
  <div class="team-head__veil" aria-hidden="true"></div>

  <div class="team-head__inner">
    <div class="team-shell">

      <!-- Bild-Ebene (75%) -->
      <div class="team-stage team-stage--img">
        <div class="team-viewport">
          <div class="team-track" id="teamImgTrack"></div>
        </div>
      </div>

      <!-- Text-Ebene (liegt über Bild, gleiche Grid-Zeile) -->
      <div class="team-stage team-stage--text">
        <div class="team-viewport">
          <div class="team-track" id="teamTextTrack"></div>
        </div>
      </div>

      <!-- Auswahl (25%) -->
      <div class="team-choice">
        <div class="team-tabsWrap">
          <div class="team-tabs" id="teamTabs"></div>
        </div>
      </div>

    </div>
  </div>
</section>

<style>
:root{
  --stage-h: 75%;
  --choice-h: 25%;
  --radius: 18px;
}

/* ===== Grundcontainer ===== */
.team-head{
  position:relative;
  width:100%;
  height:100%;
  overflow:hidden;
  background:#d9dde3;
}

.team-head__bg{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  transform:scale(1.05);
  filter:saturate(.98) contrast(.98);
}

.team-head__veil{
  position:absolute;
  inset:0;
  background:
    radial-gradient(1200px 700px at 18% 40%,
      rgba(255,255,255,.86),
      rgba(255,255,255,.18) 58%,
      rgba(255,255,255,0) 74%),
    linear-gradient(90deg,
      rgba(255,255,255,.92),
      rgba(255,255,255,.70) 40%,
      rgba(255,255,255,.22) 70%,
      rgba(255,255,255,.10));
  backdrop-filter: blur(10px);
}

.team-head__inner{
  position:relative;
  z-index:1;
  height:100%;
  padding: 20px 32px 18px;
}

/* ===== Grid-Aufteilung ===== */
.team-shell{
  height:100%;
  display:grid;
  grid-template-rows: var(--stage-h) var(--choice-h);
  gap: 14px;
}

/* ===== Bild + Text liegen in derselben Grid-Zeile ===== */
.team-stage{
  grid-row: 1;
  position:relative;
  overflow:hidden;
  border-radius: var(--radius);
}

.team-stage--img{ z-index:1; }
.team-stage--text{
  z-index:2;
  pointer-events:none; /* Tabs bleiben klickbar */
}

/* ===== Slider ===== */
.team-viewport{
  width:100%;
  height:100%;
  overflow:hidden;
}

.team-track{
  height:100%;
  display:flex;
  transform: translateX(0%);
  transition: transform .55s cubic-bezier(.22,.9,.18,1);
}

.team-slide{
  flex:0 0 100%;
  height:100%;
  position:relative;
}

/* ===== Bild ===== */
.team-portrait{
  position:absolute;
  left:20%;
  top:50%;
  transform:translate(-50%,-50%);
  width:min(420px,40vw);
  aspect-ratio:1/1;
  border-radius:999px;
  overflow:hidden;
  background:rgba(255,255,255,.55);
  box-shadow:0 22px 60px rgba(0,0,0,.18);
}

.team-portrait img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* ===== Text ===== */
.team-panelWrap{
  position:absolute;
  left:30%;
  top:50%;
  transform:translate(-50%,-50%);
  width:min(780px,70vw);
}

.team-panel{
  background:rgba(255,255,255,.84);
  border-radius:var(--radius);
  box-shadow:0 18px 50px rgba(0,0,0,.12);
  padding:22px;
}

.team-title{
  margin:0 0 10px;
  font-size:clamp(24px,2.2vw,40px);
}

.team-text{
  line-height:1.6;
  color:#1f2933;
}

/* ===== Auswahl ===== */
.team-choice{
  grid-row:2;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding-top:6px;
}

.team-tabs{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

.team-tab{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.7);
  cursor:pointer;
}

.team-tab.is-active{
  background:rgba(255,255,255,.95);
}

/* ===== Mobile ===== */
@media (max-width: 900px){
  .team-shell{
    grid-template-rows: auto auto auto;
  }

  .team-stage{
    grid-row:auto;
    height:auto;
  }

  .team-portrait{
    left:50%;
    width:min(280px,70vw);
  }

  .team-panelWrap{
    left:50%;
    width:100%;
  }

  .team-choice{
    order:2;
    align-items:center;
  }
}
</style>

<script>
(function(){
  const TEAM_MANIFEST_URL = "Team/manifest.json";

  const imgTrack = document.getElementById("teamImgTrack");
  const txtTrack = document.getElementById("teamTextTrack");
  const tabs     = document.getElementById("teamTabs");

  let members = [];
  let active = 0;

  const setActive = (i) => {
    active = i;
    const x = `translateX(${-i*100}%)`;
    imgTrack.style.transform = x;
    txtTrack.style.transform = x;
    tabs.querySelectorAll(".team-tab").forEach(t=>t.classList.remove("is-active"));
    tabs.children[i]?.classList.add("is-active");
  };

  const makeImg = (m) => {
    const s = document.createElement("div");
    s.className="team-slide";
    s.innerHTML = `
      <div class="team-portrait">
        <img src="${m.img}" alt="${m.name}">
      </div>`;
    return s;
  };

  const makeTxt = (m) => {
    const s = document.createElement("div");
    s.className="team-slide";
    s.innerHTML = `
      <div class="team-panelWrap">
        <div class="team-panel">
          <h1 class="team-title">${m.name}</h1>
          <div class="team-text">${m.text || ""}</div>
        </div>
      </div>`;
    return s;
  };

  const makeTab = (m,i) => {
    const b = document.createElement("div");
    b.className="team-tab";
    b.textContent=m.name;
    b.onclick=()=>setActive(i);
    return b;
  };

  fetch(TEAM_MANIFEST_URL)
    .then(r=>r.json())
    .then(data=>{
      members = data.members || [];
      members.forEach((m,i)=>{
        imgTrack.appendChild(makeImg(m));
        txtTrack.appendChild(makeTxt(m));
        tabs.appendChild(makeTab(m,i));
      });
      if(members.length) setActive(0);
    });
})();
</script>
<!-- backend/head.html | 3 Bereiche (Bild / Auswahl / Text) + Slider-Effekt (translateX) | Desktop: Bild+Text gelayert (Grid), Auswahl unten | Mobile: Bild -> Auswahl -> Text -->
<section class="team-head" aria-label="Team">
  <div class="team-head__bg" id="teamBg" aria-hidden="true"></div>
  <div class="team-head__veil" aria-hidden="true"></div>

  <div class="team-head__inner">
    <div class="team-shell">

      <!-- BILD (Grid-Zeile 1) -->
      <div class="team-stage team-stage--img" aria-label="Team Bild">
        <div class="team-viewport" aria-label="Team Bild Slider">
          <div class="team-track" id="teamImgTrack"></div>
        </div>
      </div>

      <!-- TEXT (Grid-Zeile 1, über Bild) -->
      <div class="team-stage team-stage--text" aria-label="Team Text">
        <div class="team-viewport" aria-label="Team Text Slider">
          <div class="team-track" id="teamTextTrack"></div>
        </div>
      </div>

      <!-- AUSWAHL (Grid-Zeile 2) -->
      <div class="team-choice" aria-label="Team Auswahl">
        <div class="team-tabsWrap">
          <div class="team-tabs" id="teamTabs"></div>
        </div>
      </div>

    </div>
  </div>
</section>

<style>
  :root{
    --title-pad-x: 72px;
    --logo-pad-left: 32px;
    --nav-pad-right: 32px;

    --edge-left:  calc(var(--title-pad-x) + var(--logo-pad-left));
    --edge-right: calc(var(--title-pad-x) + var(--nav-pad-right));

    --title-height: 70px;

    --stage-h: 75%;
    --choice-h: 25%;

    --radius: 18px;
  }

  .team-head{
    position:relative;
    width:100%;
    height:100%;
    min-height:100%;
    overflow:hidden;
    background:#d9dde3;
  }

  .team-head__bg{
    position:absolute; inset:0;
    background-size:cover;
    background-position:center;
    transform:scale(1.05);
    filter:saturate(.98) contrast(.98);
  }

  .team-head__veil{
    position:absolute; inset:0;
    background:
      radial-gradient(1200px 700px at 18% 40%, rgba(255,255,255,0.86), rgba(255,255,255,0.18) 58%, rgba(255,255,255,0.0) 74%),
      linear-gradient(90deg, rgba(255,255,255,0.92) 0%, rgba(255,255,255,0.70) 40%, rgba(255,255,255,0.22) 70%, rgba(255,255,255,0.10) 100%);
    backdrop-filter: blur(10px);
  }

  .team-head__inner{
    position:relative;
    z-index:1;
    height:100%;
    padding-left: var(--edge-left);
    padding-right: var(--edge-right);
    padding-top: 20px;
    padding-bottom: 18px;
  }

  /* ===== Desktop: Grid (oben 75% gelayert: Bild + Text | unten 25% Auswahl) ===== */
  .team-shell{
    height:100%;
    display:grid;
    grid-template-rows: var(--stage-h) var(--choice-h);
    gap: 14px;
  }

  .team-stage{
    grid-row: 1;
    position:relative;
    min-height:0;
    border-radius: var(--radius);
    overflow:hidden;
  }

  .team-stage--img{ z-index: 1; }
  .team-stage--text{
    z-index: 2;
    pointer-events:none; /* Tabs bleiben klickbar */
    background: transparent;
  }
  .team-stage--text .team-panel,
  .team-stage--text a,
  .team-stage--text button{
    pointer-events:auto;
  }

  .team-choice{
    grid-row: 2;
    min-height:0;
    display:flex;
    justify-content:center;
    align-items:flex-start; /* Buttons eher oben */
    padding-top: 6px;
  }

  /* ===== Slider ===== */
  .team-viewport{
    height:100%;
    width:100%;
    overflow:hidden;
    border-radius: var(--radius);
  }

  .team-track{
    height:100%;
    display:flex;
    width:100%;
    transform: translateX(0%);
    transition: transform .55s cubic-bezier(.22,.9,.18,1);
    will-change: transform;
  }

  .team-slide{
    flex: 0 0 100%;
    height:100%;
    position:relative;
  }

  /* ===== Bild-Slide (Desktop: Mittelpunkt bei ~20%) ===== */
  .team-portrait{
    position:absolute;
    left: 20%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: min(420px, 40vw);
    max-width: 420px;
    min-width: 220px;
    aspect-ratio: 1 / 1;
    border-radius: 999px;
    overflow:hidden;
    background: rgba(255,255,255,0.55);
    border: 1px solid rgba(15,23,42,0.10);
    box-shadow: 0 22px 60px rgba(0,0,0,0.18);
    backdrop-filter: blur(8px);
  }
  .team-portrait img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
    transform: scale(1.02);
  }

  /* ===== Text-Slide (Desktop: Panel-Mittelpunkt bei ~30%) ===== */
  .team-panelWrap{
    position:absolute;
    left: 30%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: min(780px, 70vw);
    max-width: 780px;
  }

  .team-panel{
    width: 100%;
    background: rgba(255,255,255,0.84);
    border: 1px solid rgba(15,23,42,0.10);
    border-radius: var(--radius);
    box-shadow: 0 18px 50px rgba(0,0,0,0.12);
    backdrop-filter: blur(10px);
    padding: 22px 22px 18px;
    overflow:hidden;
  }

  .team-title{
    margin:0 0 10px 0;
    font-size: clamp(24px, 2.2vw, 40px);
    line-height:1.02;
    letter-spacing:-0.02em;
    color:#0f172a;
  }

  .team-text{
    font-size: clamp(14px, 1.0vw, 16px);
    line-height:1.65;
    color: rgba(15,23,42,0.78);
    white-space: pre-wrap;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 10;
    overflow: hidden;
  }

  /* ===== Tabs unten ===== */
  .team-tabsWrap{
    width:100%;
    display:flex;
    justify-content:center;
  }

  .team-tabs{
    display:flex;
    gap: 12px;
    align-items:center;
    justify-content:center;
    max-width: min(1100px, 100%);
    padding: 6px 8px;
    overflow:hidden;
  }

  .team-tab{
    display:flex;
    align-items:center;
    gap: 10px;
    padding: 10px 14px;
    border-radius: 999px;
    background: rgba(255,255,255,0.62);
    border: 1px solid rgba(15,23,42,0.12);
    box-shadow:none;
    cursor:pointer;
    user-select:none;
    transition: background .14s ease, border-color .14s ease;
    white-space:nowrap;
    flex: 0 0 auto;
  }
  .team-tab:hover{
    background: rgba(255,255,255,0.78);
    border-color: rgba(31,79,163,0.22);
  }
  .team-tab.is-active{
    background: rgba(255,255,255,0.92);
    border-color: rgba(15,23,42,0.20);
  }

  .team-tab__avatar{
    width: 30px;
    height: 30px;
    border-radius: 999px;
    overflow:hidden;
    background:#e9eef7;
    border: 1px solid rgba(15,23,42,0.10);
    flex: 0 0 auto;
  }
  .team-tab__avatar img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .team-tab__name{
    font-weight: 760;
    color:#0f172a;
    letter-spacing:-0.01em;
  }

  /* ===== Mobile: Bild -> Auswahl -> Text, kein Overlay ===== */
  @media (max-width: 980px){
    .team-head__inner{
      padding-left: 22px;
      padding-right: 22px;
      padding-top: 16px;
      padding-bottom: 16px;
    }

    .team-shell{
      display:flex;
      flex-direction:column;
      gap: 12px;
      height:100%;
    }

    /* Bild oben mit fester “sinnvoller” Höhe */
    .team-stage{
      border-radius: var(--radius);
      overflow:hidden;
    }
    .team-stage--img{
      order: 1;
      flex: 0 0 38%;
      min-height: 220px;
      z-index: 1;
    }
    /* Auswahl mittig, Höhe nach Inhalt */
    .team-choice{
      order: 2;
      flex: 0 0 auto;
      padding-top: 0;
      align-items:center;
    }
    /* Text unten, nimmt Rest */
    .team-stage--text{
      order: 3;
      flex: 1 1 auto;
      min-height: 0;
      z-index: 1;
      pointer-events:auto;
    }
    .team-stage--text .team-viewport{ border-radius: var(--radius); }

    .team-portrait{
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: min(280px, 70vw);
      min-width: 200px;
    }

    .team-panelWrap{
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      max-width: 100%;
    }
    .team-panel{
      max-width: 100%;
      border-radius: 16px;
      padding: 18px 18px 14px;
    }

    .team-tabs{
      flex-wrap: wrap;
      justify-content:center;
    }
  }

  @media (max-width: 560px){
    .team-title{ font-size: 30px; }
    .team-text{ -webkit-line-clamp: 12; }
  }
</style>

<script>
  (function(){
    const BG_MANIFEST_URL   = "image/hintergrund/manifest.json";
    const TEAM_MANIFEST_URL = "Team/manifest.json";

    const bgEl       = document.getElementById("teamBg");
    const imgTrackEl = document.getElementById("teamImgTrack");
    const txtTrackEl = document.getElementById("teamTextTrack");
    const tabsEl     = document.getElementById("teamTabs");

    let members = [];
    let active = 0;

    function parseFolder(folder){
      const parts = String(folder).split("_");
      let pos = null;
      if (parts.length > 1) {
        const last = parts[parts.length - 1];
        const n = Number(last);
        if (Number.isFinite(n)) { pos = n; parts.pop(); }
      }
      const name = parts.join(" ").trim() || folder;
      return { name, pos };
    }

    function splitFirstSentence(text){
      const t = (text || "").trim();
      if (!t) return {
        first: "Wir sind das Team.",
        rest: "Persönlich, zuverlässig und unkompliziert – wir kümmern uns um die Details, damit euer Event entspannt bleibt."
      };

      const nl = t.indexOf("\n");
      if (nl > 0){
        const first = t.slice(0, nl).trim();
        const rest = t.slice(nl + 1).trim();
        return { first: first || "Wir sind das Team.", rest };
      }

      const m = t.match(/^[\s\S]*?[.!?](?:\s|$)/);
      if (m && m[0]){
        const cut = m[0].length;
        const first = t.slice(0, cut).trim();
        const rest = t.slice(cut).trim();
        return { first: first || "Wir sind das Team.", rest };
      }

      return { first: t, rest: "" };
    }

    async function fetchJson(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error("Fetch failed: " + url);
      return await r.json();
    }

    async function fetchText(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error("Fetch failed: " + url);
      return await r.text();
    }

    function setRandomBackground(list){
      if (!Array.isArray(list) || list.length === 0) return;
      const pick = list[Math.floor(Math.random() * list.length)];
      bgEl.style.backgroundImage = "url('image/hintergrund/" + String(pick).replace(/'/g, "%27") + "')";
    }

    function setActive(idx){
      active = idx;
      const x = "translateX(" + (-idx * 100) + "%)";
      imgTrackEl.style.transform = x;
      txtTrackEl.style.transform = x;

      tabsEl.querySelectorAll(".team-tab").forEach(el => el.classList.remove("is-active"));
      const btn = tabsEl.querySelector('[data-index="' + idx + '"]');
      if (btn) btn.classList.add("is-active");
    }

    function makeImgSlide(member){
      const slide = document.createElement("div");
      slide.className = "team-slide";

      const portrait = document.createElement("div");
      portrait.className = "team-portrait";

      const img = document.createElement("img");
      img.loading = "lazy";
      img.src = member.img;
      img.alt = member.name;
      img.onerror = () => {
        img.removeAttribute("src");
        img.alt = "";
      };

      portrait.appendChild(img);
      slide.appendChild(portrait);
      return slide;
    }

    function makeTextSlide(member){
      const slide = document.createElement("div");
      slide.className = "team-slide";

      const wrap = document.createElement("div");
      wrap.className = "team-panelWrap";

      const panel = document.createElement("div");
      panel.className = "team-panel";

      const { first, rest } = splitFirstSentence(member.text);

      const h = document.createElement("h1");
      h.className = "team-title";
      h.textContent = first || "Wir sind das Team.";

      const t = document.createElement("div");
      t.className = "team-text";
      t.textContent = (rest && rest.trim().length)
        ? rest
        : "Persönlich, zuverlässig und unkompliziert – wir kümmern uns um die Details, damit euer Event entspannt bleibt.";

      panel.appendChild(h);
      panel.appendChild(t);
      wrap.appendChild(panel);
      slide.appendChild(wrap);

      return slide;
    }

    function makeTab(member, idx){
      const btn = document.createElement("div");
      btn.className = "team-tab";
      btn.tabIndex = 0;
      btn.setAttribute("role", "button");
      btn.dataset.index = String(idx);
      btn.setAttribute("aria-label", "Teammitglied: " + member.name);

      const av = document.createElement("div");
      av.className = "team-tab__avatar";

      const img = document.createElement("img");
      img.loading = "lazy";
      img.src = member.img;
      img.alt = member.name;
      img.onerror = () => {
        av.innerHTML = "";
        const fb = document.createElement("div");
        fb.style.width="100%";
        fb.style.height="100%";
        fb.style.display="grid";
        fb.style.placeItems="center";
        fb.style.fontWeight="900";
        fb.style.color="rgba(15,23,42,0.65)";
        fb.style.background="#e9eef7";
        fb.textContent = member.name.split(" ").map(w => w[0]).slice(0,2).join("").toUpperCase();
        av.appendChild(fb);
      };
      av.appendChild(img);

      const name = document.createElement("div");
      name.className = "team-tab__name";
      name.textContent = member.name;

      btn.appendChild(av);
      btn.appendChild(name);

      const open = () => setActive(idx);
      btn.addEventListener("click", open);
      btn.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") { e.preventDefault(); open(); }
      });

      /* “von rechts rein” (stagger) */
      btn.style.opacity = "0";
      btn.style.transform = "translateX(18px)";
      requestAnimationFrame(() => {
        btn.style.transition = "opacity .28s ease, transform .28s ease";
        btn.style.transitionDelay = (idx * 45) + "ms";
        btn.style.opacity = "1";
        btn.style.transform = "translateX(0)";
      });

      return btn;
    }

    async function load(){
      try{
        const bg = await fetchJson(BG_MANIFEST_URL);
        setRandomBackground(bg);
      }catch(e){}

      const manifest = await fetchJson(TEAM_MANIFEST_URL);
      const folders = (manifest && Array.isArray(manifest.members))
        ? manifest.members.map(m => m.folder).filter(Boolean)
        : [];

      members = await Promise.all(folders.map(async (folder) => {
        const meta = parseFolder(folder);
        const base = "Team/" + folder + "/";
        const img  = base + "image.png";
        const txt  = base + "team.txt";
        let text = "";
        try{ text = await fetchText(txt); }catch(e){ text = ""; }
        return { folder, name: meta.name, pos: meta.pos, img, text };
      }));

      members.sort((a,b) => {
        const ap = (a.pos == null) ? 9999 : a.pos;
        const bp = (b.pos == null) ? 9999 : b.pos;
        if (ap !== bp) return ap - bp;
        return a.name.localeCompare(b.name, "de");
      });

      imgTrackEl.innerHTML = "";
      txtTrackEl.innerHTML = "";
      tabsEl.innerHTML = "";

      members.forEach((m, i) => {
        imgTrackEl.appendChild(makeImgSlide(m));
        txtTrackEl.appendChild(makeTextSlide(m));
        tabsEl.appendChild(makeTab(m, i));
      });

      if (members.length) setActive(0);
    }

    load().catch(() => {});
  })();
</script>
