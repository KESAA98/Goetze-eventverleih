<!-- backend/head.html | Clean vA: index steuert Navigation, head ist nur Inhalt -->
<style>
  :root{
    --radius: 18px;
    --shadow-soft: 0 12px 34px rgba(0,0,0,.14);

    --bg-hero: #d9dde3;
    --bg-panel: rgba(255,255,255,.92);
    --text: #0f172a;
    --muted: #64748b;

    --gap: 18px;
    --pad: 22px;

    --tab-h: 56px;
    --tab-radius: 999px;
    --tab-bg: rgba(255,255,255,.72);
    --tab-bg-active: rgba(255,255,255,.95);
    --tab-border: rgba(15,23,42,.10);
  }

  *{ box-sizing:border-box; }

  .head-wrap{
    width:100%;
    background: var(--bg-hero);
    border-radius: var(--radius);
    overflow:hidden;
  }

  /* ===== HERO (Slider) ===== */
  .hero{
    width:100%;
    position:relative;
    padding: var(--pad);
  }

  .slider{
    width:100%;
    overflow:hidden;
    border-radius: calc(var(--radius) - 2px);
    background: rgba(255,255,255,.08);
  }

  .track{
    display:flex;
    width:100%;
    will-change: transform;
    transition: transform .35s ease;
  }

  .slide{
    flex: 0 0 100%;
    width:100%;
    padding: 0;
  }

  /* Desktop Layout: Text links, Bild rechts */
  .card{
    display:flex;
    gap: var(--gap);
    align-items: stretch;
    width:100%;
    padding: var(--pad);
    background: var(--bg-panel);
    border-radius: calc(var(--radius) - 2px);
    box-shadow: var(--shadow-soft);
  }

  .text{
    flex: 1 1 60%;
    min-width: 0;
    color: var(--text);
  }

  .name{
    margin:0 0 10px 0;
    font-size: clamp(22px, 2.2vw, 30px);
    line-height:1.1;
    letter-spacing:.2px;
  }

  .role{
    margin:0 0 14px 0;
    color: var(--muted);
    font-size: 15px;
  }

  /* GANZER TEXT: niemals clamp/hidden */
  .body{
    margin:0;
    font-size: 16px;
    line-height: 1.55;
    white-space: pre-wrap; /* respektiert Umbrüche aus JSON */
    overflow: visible;
  }

  .portraitWrap{
    flex: 0 0 40%;
    min-width: 240px;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .portrait{
    width:min(320px, 100%);
    aspect-ratio: 1 / 1;
    border-radius: 999px;
    overflow:hidden;
    box-shadow: 0 18px 44px rgba(0,0,0,.20);
    background: rgba(255,255,255,.35);
  }
  .portrait img{
    width:100%;
    height:100%;
    object-fit: cover;
    display:block;
  }

  /* ===== TABS (Auswahl) ===== */
  .tabsBar{
    margin-top: var(--gap);
    display:flex;
    gap: 10px;
    align-items:center;
    overflow:auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 2px;
  }
  .tabsBar::-webkit-scrollbar{ height: 10px; }
  .tabsBar::-webkit-scrollbar-thumb{ background: rgba(15,23,42,.15); border-radius: 999px; }
  .tabsBar::-webkit-scrollbar-track{ background: rgba(255,255,255,.15); border-radius: 999px; }

  .tab{
    height: var(--tab-h);
    display:inline-flex;
    align-items:center;
    gap: 10px;
    padding: 0 14px 0 10px;
    border-radius: var(--tab-radius);
    border: 1px solid var(--tab-border);
    background: var(--tab-bg);
    color: var(--text);
    cursor:pointer;
    user-select:none;
    flex: 0 0 auto;
    transition: transform .12s ease, background .12s ease, border-color .12s ease;
  }
  .tab:active{ transform: scale(.98); }
  .tab.is-active{
    background: var(--tab-bg-active);
    border-color: rgba(15,23,42,.18);
  }

  .tabAvatar{
    width: 38px;
    height: 38px;
    border-radius: 999px;
    overflow:hidden;
    flex: 0 0 38px;
    background: rgba(255,255,255,.55);
    border: 1px solid rgba(15,23,42,.10);
  }
  .tabAvatar img{
    width:100%;
    height:100%;
    object-fit: cover;
    display:block;
  }
  .tabName{
    font-size: 14px;
    font-weight: 600;
    white-space: nowrap;
  }

  /* ===== Mobile Layout: Bild oben, dann Auswahl, dann Text ===== */
  @media (max-width: 900px){
    .hero{ padding: 14px; }
    .card{
      flex-direction: column;
      padding: 16px;
    }
    .portraitWrap{
      flex: 0 0 auto;
      min-width: 0;
      width:100%;
      justify-content:center;
      margin-bottom: 6px;
    }
    .portrait{
      width: 140px;
    }
    .name{ margin-top: 6px; }
    .tabsBar{ margin-top: 12px; }
  }
</style>

<div class="head-wrap" id="headRoot">
  <div class="hero">
    <div class="slider" aria-label="Team Slider">
      <div class="track" id="teamTrack"></div>
    </div>

    <!-- Auswahl bleibt IMMER separat (nicht in Slides verschieben!) -->
    <div class="tabsBar" id="tabsBar" aria-label="Team Auswahl"></div>
  </div>
</div>

<script>
(function(){
  "use strict";

  const TEAM_MANIFEST_URL = "Team/manifest.json";

  const track = document.getElementById("teamTrack");
  const tabsBar = document.getElementById("tabsBar");

  let members = [];
  let activeIndex = 0;

  function esc(s){
    return String(s ?? "").replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[c]));
  }

  function setActive(idx, opts = { focusTab:false, scrollTab:true }){
    if(!members.length) return;
    activeIndex = Math.max(0, Math.min(idx, members.length - 1));

    // slider
    track.style.transform = `translateX(${-activeIndex * 100}%)`;

    // tabs
    const tabs = tabsBar.querySelectorAll(".tab");
    tabs.forEach((t, i) => {
      if(i === activeIndex) t.classList.add("is-active");
      else t.classList.remove("is-active");
    });

    const activeTab = tabs[activeIndex];
    if(activeTab && opts.scrollTab){
      activeTab.scrollIntoView({ behavior:"smooth", inline:"center", block:"nearest" });
    }
    if(activeTab && opts.focusTab){
      activeTab.focus({ preventScroll:true });
    }
  }

  function buildSlides(){
    track.innerHTML = members.map(m => {
      const name = esc(m.name);
      const role = esc(m.role);
      const body = esc(m.text);
      const img  = esc(m.image);

      return `
        <div class="slide">
          <div class="card">
            <div class="text">
              <h2 class="name">${name}</h2>
              ${role ? `<p class="role">${role}</p>` : ``}
              <p class="body">${body}</p>
            </div>
            <div class="portraitWrap">
              <div class="portrait">
                ${img ? `<img src="${img}" alt="${name}">` : ``}
              </div>
            </div>
          </div>
        </div>
      `;
    }).join("");
  }

  function buildTabs(){
    tabsBar.innerHTML = members.map((m, i) => {
      const name = esc(m.name);
      const img  = esc(m.image);
      return `
        <button class="tab" type="button" data-i="${i}" aria-label="${name}">
          <span class="tabAvatar">${img ? `<img src="${img}" alt="">` : ``}</span>
          <span class="tabName">${name}</span>
        </button>
      `;
    }).join("");

    tabsBar.addEventListener("click", (e) => {
      const btn = e.target.closest(".tab");
      if(!btn) return;
      const i = parseInt(btn.dataset.i, 10);
      if(Number.isFinite(i)) setActive(i, { focusTab:false, scrollTab:true });
    }, { passive:true });

    // Keyboard: links/rechts auf Tabs
    tabsBar.addEventListener("keydown", (e) => {
      if(e.key !== "ArrowLeft" && e.key !== "ArrowRight") return;
      e.preventDefault();
      const dir = e.key === "ArrowRight" ? 1 : -1;
      setActive(activeIndex + dir, { focusTab:true, scrollTab:true });
    });
  }

  async function fetchJson(url){
    const r = await fetch(url, { cache:"no-store" });
    if(!r.ok) throw new Error("Fetch failed: " + url + " (" + r.status + ")");
    return r.json();
  }

  function normalizeManifest(manifest){
    // Erwartet z.B.:
    // { "members":[ { "name":"...", "role":"...", "text":"...", "image":"Team/kevin.jpg" }, ... ] }
    const arr = Array.isArray(manifest?.members) ? manifest.members : [];
    return arr.map(x => ({
      name: x?.name ?? "",
      role: x?.role ?? "",
      text: x?.text ?? "",
      image: x?.image ?? ""
    })).filter(x => x.name || x.text || x.image);
  }

  async function init(){
    try{
      const manifest = await fetchJson(TEAM_MANIFEST_URL);
      members = normalizeManifest(manifest);

      if(!members.length){
        track.innerHTML = `
          <div class="slide">
            <div class="card">
              <div class="text">
                <h2 class="name">Team-Daten fehlen</h2>
                <p class="body">Bitte prüfe ${TEAM_MANIFEST_URL} (members[]).</p>
              </div>
            </div>
          </div>`;
        tabsBar.innerHTML = "";
        return;
      }

      buildSlides();
      buildTabs();
      setActive(0, { focusTab:false, scrollTab:false });

      // Swipe auf Slider (Mobile)
      let startX = 0, dx = 0, dragging = false;
      track.addEventListener("pointerdown", (e) => {
        dragging = true;
        startX = e.clientX;
        dx = 0;
        track.setPointerCapture(e.pointerId);
      });
      track.addEventListener("pointermove", (e) => {
        if(!dragging) return;
        dx = e.clientX - startX;
      });
      track.addEventListener("pointerup", () => {
        if(!dragging) return;
        dragging = false;
        const threshold = 40;
        if(dx > threshold) setActive(activeIndex - 1, { focusTab:false, scrollTab:true });
        else if(dx < -threshold) setActive(activeIndex + 1, { focusTab:false, scrollTab:true });
      });
      track.addEventListener("pointercancel", () => { dragging = false; });

    }catch(err){
      console.error(err);
      track.innerHTML = `
        <div class="slide">
          <div class="card">
            <div class="text">
              <h2 class="name">Team konnte nicht geladen werden</h2>
              <p class="body">Prüfe Pfad/Datei: ${TEAM_MANIFEST_URL}</p>
            </div>
          </div>
        </div>`;
      tabsBar.innerHTML = "";
    }
  }

  init();
})();
</script>
