<!-- backend/head.html  | Team Head: links Text + rechts großes rundes Bild + unten Tabs -->
<section class="team-head" aria-label="Team">
  <div class="team-head__bg" id="teamBg" aria-hidden="true"></div>
  <div class="team-head__veil" aria-hidden="true"></div>

  <div class="team-head__inner">
    <div class="team-head__main">
      <!-- Links: Text -->
      <div class="team-head__left">
        <h1 class="team-head__title" id="teamTitle">Wir sind das Team.</h1>
        <p class="team-head__lead" id="teamLead">
          Persönlich, zuverlässig und unkompliziert – wir kümmern uns um die Details, damit euer Event entspannt bleibt.
        </p>
      </div>

      <!-- Rechts: großes rundes Bild -->
      <div class="team-head__right" aria-hidden="true">
        <div class="team-head__portrait">
          <img id="teamPortrait" alt="" />
        </div>
      </div>
    </div>

    <!-- Unten: Tabs -->
    <div class="team-tabs" id="teamTabs" aria-label="Team Auswahl">
      <!-- wird per JS befüllt -->
    </div>
  </div>
</section>

<style>
  /* nutzt die "edge" Abstände aus deinem Head/Titel-Konzept */
  :root{
    --title-pad-x: 72px;
    --logo-pad-left: 32px;
    --nav-pad-right: 32px;

    --edge-left:  calc(var(--title-pad-x) + var(--logo-pad-left));
    --edge-right: calc(var(--title-pad-x) + var(--nav-pad-right));

    --radius: 18px;
    --shadow-soft: 0 12px 34px rgba(0,0,0,.14);
  }

  .team-head{
    position:relative;
    width:100%;
    height:100%;
    min-height:100%;
    border-radius: var(--radius);
    overflow:hidden;
    box-shadow: var(--shadow-soft);
    background:#d9dde3;
  }

  .team-head__bg{
    position:absolute; inset:0;
    background-size: cover;
    background-position: center;
    transform: scale(1.04);
    filter: saturate(0.95) contrast(0.98);
  }
  .team-head__veil{
    position:absolute; inset:0;
    background:
      radial-gradient(1200px 600px at 16% 42%, rgba(255,255,255,0.82), rgba(255,255,255,0.10) 60%, rgba(255,255,255,0.0) 74%),
      linear-gradient(90deg, rgba(255,255,255,0.92) 0%, rgba(255,255,255,0.72) 38%, rgba(255,255,255,0.22) 66%, rgba(255,255,255,0.10) 100%);
    backdrop-filter: blur(10px);
  }

  .team-head__inner{
    position:relative;
    z-index:1;
    height:100%;
    display:flex;
    flex-direction:column;
    justify-content:space-between;

    /* gleiches Padding links/rechts wie Titel/Logo-Edges */
    padding-left:  var(--edge-left);
    padding-right: var(--edge-right);

    /* oben/unten gleichmäßig */
    padding-top: 34px;
    padding-bottom: 34px;
    gap: 18px;
  }

  .team-head__main{
    display:grid;
    grid-template-columns: 1.05fr 0.95fr;
    gap: clamp(18px, 3vw, 44px);
    align-items:center;
    min-height: 0;
  }

  .team-head__left{
    display:flex;
    flex-direction:column;
    gap: 14px;
    min-width:0;
  }

  .team-head__title{
    margin:0;
    font-size: clamp(28px, 3.3vw, 54px);
    line-height: 1.02;
    letter-spacing: -0.02em;
    color: #0f172a;
  }

  .team-head__lead{
    margin:0;
    max-width: 62ch;
    font-size: clamp(14px, 1.15vw, 17px);
    line-height: 1.6;
    color: rgba(15,23,42,0.78);
  }

  .team-head__right{
    display:flex;
    justify-content:center;
    align-items:center;
    min-width:0;
  }

  .team-head__portrait{
    width: min(360px, 34vw);
    aspect-ratio: 1 / 1;
    border-radius: 999px;
    overflow:hidden;
    background: rgba(255,255,255,0.55);
    border: 1px solid rgba(15,23,42,0.10);
    box-shadow: 0 22px 60px rgba(0,0,0,0.18);
    backdrop-filter: blur(8px);
  }

  .team-head__portrait img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
    transform: scale(1.02);
  }

  /* Tabs */
  .team-tabs{
    display:flex;
    gap: 12px;
    overflow:auto;
    padding: 10px 0 2px;
    align-items:stretch;
  }

  .team-tabs::-webkit-scrollbar{ height: 10px; }
  .team-tabs::-webkit-scrollbar-track{ background: transparent; }
  .team-tabs::-webkit-scrollbar-thumb{
    background: rgba(15,23,42,0.14);
    border-radius: 999px;
    border: 3px solid transparent;
    background-clip: padding-box;
  }

  .team-tab{
    display:flex;
    align-items:center;
    gap: 10px;
    padding: 10px 14px;
    border-radius: 999px;
    background: rgba(255,255,255,0.70);
    border: 1px solid rgba(15,23,42,0.10);
    box-shadow: 0 10px 22px rgba(0,0,0,0.08);
    cursor:pointer;
    user-select:none;
    transition: transform .14s ease, background .14s ease, border-color .14s ease;
    flex: 0 0 auto;
    min-width: 180px;
  }

  .team-tab:hover{
    transform: translateY(-1px);
    background: rgba(255,255,255,0.82);
    border-color: rgba(31,79,163,0.22);
  }

  .team-tab.is-active{
    background: rgba(255,255,255,0.92);
    border-color: rgba(31,79,163,0.30);
  }

  .team-tab__avatar{
    width: 34px;
    height: 34px;
    border-radius: 999px;
    overflow:hidden;
    background:#e9eef7;
    border: 1px solid rgba(15,23,42,0.10);
    flex: 0 0 auto;
  }

  .team-tab__avatar img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  .team-tab__name{
    font-weight: 750;
    color:#0f172a;
    letter-spacing: -0.01em;
    white-space: nowrap;
    overflow:hidden;
    text-overflow: ellipsis;
  }

  /* Responsive */
  @media (max-width: 980px){
    .team-head__inner{
      padding-left: 24px;
      padding-right: 24px;
      padding-top: 22px;
      padding-bottom: 22px;
    }
    .team-head__main{
      grid-template-columns: 1fr;
      gap: 18px;
    }
    .team-head__right{
      justify-content:flex-start;
    }
    .team-head__portrait{
      width: min(300px, 62vw);
    }
  }
</style>

<script>
  (function(){
    const BG_MANIFEST_URL   = "image/hintergrund/manifest.json"; // Dateinamen
    const TEAM_MANIFEST_URL = "Team/manifest.json";              // {members:[{folder:"Lisa_2"}]}

    const bgEl = document.getElementById("teamBg");

    const titleEl = document.getElementById("teamTitle");
    const leadEl  = document.getElementById("teamLead");
    const portraitEl = document.getElementById("teamPortrait");
    const tabsEl = document.getElementById("teamTabs");

    function parseFolder(folder){
      const parts = String(folder).split("_");
      let pos = null;

      if (parts.length > 1) {
        const last = parts[parts.length - 1];
        const n = Number(last);
        if (Number.isFinite(n)) { pos = n; parts.pop(); }
      }
      const name = parts.join(" ").trim() || folder;
      return { name, pos };
    }

    function splitFirstSentence(text){
      const t = (text || "").trim();
      if (!t) return { first: "Wir sind das Team.", rest: "Persönlich, zuverlässig und unkompliziert – wir kümmern uns um die Details, damit euer Event entspannt bleibt." };

      // erster Satz bis zum ersten Zeilenumbruch ODER bis zur ersten Satz-Endung
      const nl = t.indexOf("\n");
      const cutNl = nl > 0 ? nl : -1;

      let cut = cutNl;

      if (cut === -1) {
        const m = t.match(/^[\s\S]*?[.!?](?:\s|$)/);
        cut = m ? m[0].length : -1;
      }

      if (cut > 0) {
        const first = t.slice(0, cut).trim();
        const rest  = t.slice(cut).trim();
        return { first: first || "Wir sind das Team.", rest: rest || "Persönlich, zuverlässig und unkompliziert – wir kümmern uns um die Details, damit euer Event entspannt bleibt." };
      }

      return { first: t, rest: "" };
    }

    async function fetchJson(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error("Fetch failed: " + url);
      return await r.json();
    }

    async function fetchText(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error("Fetch failed: " + url);
      return await r.text();
    }

    function setRandomBackground(list){
      if (!Array.isArray(list) || list.length === 0) return;
      const pick = list[Math.floor(Math.random() * list.length)];
      bgEl.style.backgroundImage = "url('image/hintergrund/" + String(pick).replace(/'/g, "%27") + "')";
    }

    function setPortrait(src, alt){
      portraitEl.src = src;
      portraitEl.alt = alt || "";
      portraitEl.onerror = () => {
        portraitEl.removeAttribute("src");
        portraitEl.alt = "";
        portraitEl.style.display = "none";
      };
      portraitEl.style.display = "block";
    }

    function setActive(member){
      // active state
      tabsEl.querySelectorAll(".team-tab").forEach(el => el.classList.remove("is-active"));
      const btn = tabsEl.querySelector('[data-folder="' + CSS.escape(member.folder) + '"]');
      if (btn) btn.classList.add("is-active");

      const { first, rest } = splitFirstSentence(member.text);
      titleEl.textContent = first || "Wir sind das Team.";
      leadEl.textContent  = rest || "Persönlich, zuverlässig und unkompliziert – wir kümmern uns um die Details, damit euer Event entspannt bleibt.";
      setPortrait(member.img, member.name);
    }

    function makeTab(member){
      const btn = document.createElement("div");
      btn.className = "team-tab";
      btn.tabIndex = 0;
      btn.setAttribute("role", "button");
      btn.dataset.folder = member.folder;
      btn.setAttribute("aria-label", "Teammitglied: " + member.name);

      const av = document.createElement("div");
      av.className = "team-tab__avatar";

      const img = document.createElement("img");
      img.loading = "lazy";
      img.src = member.img;
      img.alt = member.name;
      img.onerror = () => {
        av.innerHTML = "";
        const fb = document.createElement("div");
        fb.style.width="100%";
        fb.style.height="100%";
        fb.style.display="grid";
        fb.style.placeItems="center";
        fb.style.fontWeight="900";
        fb.style.color="rgba(15,23,42,0.65)";
        fb.style.background="#e9eef7";
        fb.textContent = member.name.split(" ").map(w => w[0]).slice(0,2).join("").toUpperCase();
        av.appendChild(fb);
      };
      av.appendChild(img);

      const name = document.createElement("div");
      name.className = "team-tab__name";
      name.textContent = member.name;

      btn.appendChild(av);
      btn.appendChild(name);

      const open = () => setActive(member);
      btn.addEventListener("click", open);
      btn.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") { e.preventDefault(); open(); }
      });

      return btn;
    }

    async function load(){
      // background (best-effort)
      try{
        const bg = await fetchJson(BG_MANIFEST_URL);
        setRandomBackground(bg);
      }catch(e){}

      // team
      const manifest = await fetchJson(TEAM_MANIFEST_URL);
      const folders = (manifest && Array.isArray(manifest.members))
        ? manifest.members.map(m => m.folder).filter(Boolean)
        : [];

      const members = await Promise.all(folders.map(async (folder) => {
        const meta = parseFolder(folder);
        const base = "Team/" + folder + "/";
        const img  = base + "image.png";
        const txt  = base + "team.txt";
        let text = "";
        try{ text = await fetchText(txt); }catch(e){ text = ""; }
        return { folder, name: meta.name, pos: meta.pos, img, text };
      }));

      // sort by pos ascending (Position 1 zuerst)
      members.sort((a,b) => {
        const ap = (a.pos == null) ? 9999 : a.pos;
        const bp = (b.pos == null) ? 9999 : b.pos;
        if (ap !== bp) return ap - bp;
        return a.name.localeCompare(b.name, "de");
      });

      // tabs render
      tabsEl.innerHTML = "";
      members.forEach(m => tabsEl.appendChild(makeTab(m)));

      // default active: Position 1 (first in sort)
      if (members.length) setActive(members[0]);
    }

    load().catch(() => {
      // minimal fallback if manifests missing
      titleEl.textContent = "Wir sind das Team.";
      leadEl.textContent  = "Persönlich, zuverlässig und unkompliziert – wir kümmern uns um die Details, damit euer Event entspannt bleibt.";
    });
  })();
</script>
