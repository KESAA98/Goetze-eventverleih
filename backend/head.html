<!-- backend/head.html | Slider: Text-Panel links + Portrait rechts | Team Tabs | Smooth Scroll
     Fixes:
     - Kein Text-Cutoff (TXT wird komplett angezeigt)
     - Slides/Tabs starten am echten Rand (kein "unsichtbarer Innenrand")
     - Head darf in der Höhe mitwachsen (ohne Scroll im Textpanel)
-->

<section class="team-head" aria-label="Team">
  <div class="team-head__bg" id="teamBg" aria-hidden="true"></div>
  <div class="team-head__veil" aria-hidden="true"></div>

  <!-- Interner Scroll (Head) -->
  <div class="team-scroll" id="teamScroll" aria-label="Team Inhalt">
    <div class="team-stage">

      <!-- Zone A -->
      <div class="sceneZone" aria-label="Vorstellung">
        <div class="team-viewport" aria-label="Team Slider">
          <div class="team-track" id="teamTrack"></div>
        </div>
      </div>

      <!-- Zone B (Desktop Tabs) -->
      <div class="selectorZone" id="selectorZone" aria-label="Team Auswahl">
        <div class="team-tabs" id="teamTabs"></div>
      </div>

      <!-- Gate (optional) -->
      <div class="gateZone" id="gateZone" aria-hidden="true">
        <button class="gateBtn" id="gateBtn" type="button">Zum Shop ↓</button>
      </div>

    </div>
  </div>

<style>
  :root{
    --radius: 18px;
    --panel-bg: rgba(255,255,255,0.84);
    --panel-border: rgba(15,23,42,0.10);
    --panel-shadow: 0 18px 50px rgba(0,0,0,0.12);

    --zoneA: 80%;
    --zoneB: 20%;

    --text-max-w: min(780px, 60vw);  /* Textpanel max */
    --img-max:  min(420px, 34vw);    /* Portrait max */

    --chip-h: 46px;
  }

  *{ box-sizing:border-box; }

  .team-head{
    position:relative;
    width:100%;
    min-height:100vh;
    height:auto;
    overflow:visible;
    background:#d9dde3;
  }

  .team-head__bg{
    position:absolute; inset:0;
    background-size:cover;
    background-position:center;
    transform:scale(1.05);
    filter:saturate(.98) contrast(.98);
  }

  .team-head__veil{
    position:absolute; inset:0;
    background:
      radial-gradient(1200px 700px at 18% 40%, rgba(255,255,255,0.86), rgba(255,255,255,0.18) 58%, rgba(255,255,255,0.0) 74%),
      linear-gradient(90deg, rgba(255,255,255,0.92) 0%, rgba(255,255,255,0.55) 40%, rgba(255,255,255,0.22) 70%, rgba(255,255,255,0.10) 100%);
    backdrop-filter: blur(10px);
  }

  .team-scroll{
    position:relative;
    z-index:1;
    width:100%;
    height:auto;
    overflow:visible;
    padding: 0;
  }

  .team-stage{
    position:relative;
    width:100%;
    min-height:100vh;
    height:auto;
    display:flex;
    flex-direction:column;
    gap: 12px;
  }

  .sceneZone{
    flex: 0 0 auto;
    min-height: 320px;
    border-radius: var(--radius);
    overflow:hidden;
  }

  .selectorZone{
    flex: 0 0 auto;
    min-height: 96px;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding-top: 6px;
    background: transparent;
    box-shadow:none;
  }

  .team-viewport{
    width:100%;
    height:100%;
    overflow:hidden;
    border-radius: var(--radius);
  }

  .team-track{
    height:100%;
    display:flex;
    width:100%;
    transform: translateX(0%);
    transition: transform .55s cubic-bezier(.22,.9,.18,1);
    will-change: transform;
  }

  .team-slide{
    flex: 0 0 100%;
    height:auto;
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 0;
  }

  /* === Slide Layout Desktop: Text links + Bild rechts (getrennt, KEIN gemeinsamer Container) === */
  .slide-grid{
    width: 100%;
    height: auto;
    display:flex;
    align-items:center;
    justify-content:center;
    gap: clamp(18px, 3vw, 44px);
  }

  .textPanel{
    width: var(--text-max-w);
    max-height: none;
    overflow: visible;
    background: var(--panel-bg);
    border: 1px solid var(--panel-border);
    border-radius: var(--radius);
    box-shadow: var(--panel-shadow);
    backdrop-filter: blur(10px);
    padding: 22px 22px 18px;
  }

  .textTitle{
    margin: 0 0 10px 0;
    font-weight: 800;
    letter-spacing:-0.02em;
    font-size: clamp(24px, 2.2vw, 40px);
    line-height:1.02;
    color: rgba(15,23,42,0.92);
  }

  .textBody{
    font-size: clamp(14px, 1.0vw, 16px);
    line-height:1.65;
    color: rgba(15,23,42,0.78);
    white-space: pre-wrap;
  }

  .portrait{
    width: 100%;
    max-width: var(--img-max);
    max-height: 82%;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .portrait img{
    width: 100%;
    height: auto;
    border-radius: 999px;
    border: 6px solid rgba(255,255,255,0.70);
    box-shadow: 0 22px 55px rgba(0,0,0,0.18);
    background: rgba(255,255,255,0.4);
  }

  /* Tabs */
  .team-tabs{
    display:flex;
    gap: 12px;
    align-items:center;
    justify-content:center;
    width: 100%;
    overflow:hidden;
    background: transparent;
    padding: 0 12px;
  }

  .team-tab{
    display:flex;
    align-items:center;
    gap: 10px;
    padding: 10px 14px;
    border-radius: 999px;
    background: rgba(255,255,255,0.62);
    border: 1px solid rgba(15,23,42,0.12);
    cursor:pointer;
    user-select:none;
    transition: transform .15s ease, background .2s ease, border-color .2s ease;
  }
  .team-tab:hover{ transform: translateY(-1px); }

  .team-tab.active{
    background: rgba(255,255,255,0.86);
    border-color: rgba(15,23,42,0.18);
  }
  .team-tab:active{ transform: scale(0.98); }

  .chipAvatar{
    width: 26px; height: 26px;
    border-radius:999px;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    background: rgba(15,23,42,0.12);
    border: 1px solid rgba(15,23,42,0.12);
    flex: 0 0 26px;
  }
  .chipAvatar img{ width:100%; height:100%; object-fit:cover; display:block; }

  .chipLabel{
    font-weight: 700;
    font-size: 14px;
    color: rgba(15,23,42,0.88);
    white-space: nowrap;
  }

  /* Gate Button */
  .gateZone{
    display:flex;
    justify-content:center;
    padding: 6px 0 18px;
  }
  .gateBtn{
    border: 0;
    padding: 12px 18px;
    border-radius: 999px;
    background: rgba(15,23,42,0.90);
    color: #fff;
    font-weight: 800;
    letter-spacing:.01em;
    cursor:pointer;
    box-shadow: 0 18px 46px rgba(0,0,0,0.22);
    transform: translateY(0);
    transition: transform .15s ease, opacity .25s ease;
  }
  .gateBtn:hover{ transform: translateY(-1px); }

  /* ===== Mobile: Bild oben, Text unten, Tabs fix unten ===== */
  @media (max-width: 980px){
    .sceneZone{
      border-radius: 0;
    }
    .team-viewport{
      border-radius: 0;
    }

    .slide-grid{
      flex-direction:column;
      justify-content:flex-start;
      gap: 16px;
      padding: 14px 14px 92px;
    }

    .portrait{
      max-width: min(420px, 84vw);
      max-height:none;
      margin-top: 8px;
    }

    .textPanel{
      width: 100%;
      max-width: 820px;
    }

    .textBody{
      -webkit-line-clamp: unset;
    }

    .selectorZone{
      position: sticky;
      bottom: 0;
      z-index: 5;
      background: rgba(255,255,255,0.62);
      backdrop-filter: blur(12px);
      padding: 10px 10px 12px;
      border-top: 1px solid rgba(15,23,42,0.10);
      min-height: auto;
    }

    .team-tabs{
      justify-content:flex-start;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding: 0 2px;
    }
    .team-tabs::-webkit-scrollbar{ height: 0; }

    .gateZone{ display:none; }
  }
</style>

<script>
  (function(){
    const BG_MANIFEST_URL   = "image/manifest_background.json";  // optional
    const MEMBER_MANIFEST   = "backend/team_manifest.json";      // fallback: hardcoded data below if missing

    const bgEl    = document.getElementById("teamBg");
    const trackEl = document.getElementById("teamTrack");
    const tabsEl  = document.getElementById("teamTabs");
    const selectorZone = document.getElementById("selectorZone");
    const scrollEl = document.getElementById("teamScroll");
    const gateZone = document.getElementById("gateZone");
    const gateBtn  = document.getElementById("gateBtn");

    const mqMobile = window.matchMedia("(max-width: 980px)");

    // Fallback Team (falls JSON fehlt)
    const fallbackMembers = [
      {
        id:"welcome",
        name:"Willkommen bei LG Eventverleih",
        title:"Schön, dass du da bist!",
        text:
`Wir sind LG Eventverleih – ein kleines, engagiertes Team mit einer großen Leidenschaft für besondere Momente. Unser Ziel ist es, dein Event unkompliziert, stilvoll und zuverlässig auszustatten, damit du dich ganz auf das Feiern konzentrieren kannst.

Ob Hochzeit, Geburtstag, Gartenfest oder Firmenveranstaltung: Wir stellen dir ausgewählte Mietartikel zur Verfügung, die Atmosphäre schaffen und deinem Anlass eine persönliche Note verleihen. Dabei legen wir großen Wert auf Qualität, Sorgfalt und einen reibungslosen Ablauf – von der Planung bis zum Abbau.

Als Team arbeiten wir Hand in Hand: kreativ in der Auswahl, zuverlässig in der Organisation und professionell in der Umsetzung. Kurze Wege, klare Absprachen und ein offenes Ohr für deine Wünsche sind für uns selbstverständlich.

Wir freuen uns darauf, Teil deines Events zu sein und gemeinsam etwas Besonderes entstehen zu lassen.`,
        avatar:"image/avatar_placeholder.png"
      },
      {
        id:"lisa",
        name:"Lisa",
        title:"Lisa",
        text:`Hier kommt später der Text für Lisa aus der TXT-Datei.`,
        avatar:"image/avatar_placeholder.png"
      },
      {
        id:"kevin",
        name:"Kevin",
        title:"Kevin",
        text:`Hier kommt später der Text für Kevin aus der TXT-Datei.`,
        avatar:"image/avatar_placeholder.png"
      },
      {
        id:"melivin",
        name:"Melivin",
        title:"Melivin",
        text:`Hier kommt später der Text für Melivin aus der TXT-Datei.`,
        avatar:"image/avatar_placeholder.png"
      }
    ];

    function safeFetchJson(url){
      return fetch(url, {cache:"no-store"}).then(r => r.ok ? r.json() : null).catch(() => null);
    }

    function setBg(url){
      if(!url) return;
      bgEl.style.backgroundImage = `url("${url}")`;
    }

    function firstSentence(text){
      const t = (text || "").trim();
      if(!t) return "";
      const m = t.match(/^(.+?[.!?])(\s|$)/);
      return m ? m[1] : t.split("\n")[0];
    }

    function buildSlide(member){
      const slide = document.createElement("div");
      slide.className = "team-slide";

      const grid = document.createElement("div");
      grid.className = "slide-grid";

      const textPanel = document.createElement("div");
      textPanel.className = "textPanel";

      const h = document.createElement("h2");
      h.className = "textTitle";
      h.textContent = member.title || member.name || "";

      const body = document.createElement("div");
      body.className = "textBody";
      body.textContent = member.text || "";

      textPanel.appendChild(h);
      textPanel.appendChild(body);

      const portrait = document.createElement("div");
      portrait.className = "portrait";
      const img = document.createElement("img");
      img.alt = member.name || "Portrait";
      img.src = member.portrait || member.avatar || "image/avatar_placeholder.png";
      portrait.appendChild(img);

      grid.appendChild(textPanel);
      grid.appendChild(portrait);

      slide.appendChild(grid);
      return slide;
    }

    function buildTab(member, idx){
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "team-tab";
      btn.setAttribute("data-idx", String(idx));

      const av = document.createElement("span");
      av.className = "chipAvatar";
      const img = document.createElement("img");
      img.alt = "";
      img.src = member.avatar || member.portrait || "image/avatar_placeholder.png";
      av.appendChild(img);

      const label = document.createElement("span");
      label.className = "chipLabel";
      label.textContent = member.name || ("Team " + (idx+1));

      btn.appendChild(av);
      btn.appendChild(label);

      btn.addEventListener("click", () => goTo(idx));
      return btn;
    }

    let members = [];
    let active = 0;

    function markActive(){
      const tabs = tabsEl.querySelectorAll(".team-tab");
      tabs.forEach((t,i) => t.classList.toggle("active", i===active));
    }

    function goTo(idx){
      active = idx;
      trackEl.style.transform = "translateX(" + (-idx * 100) + "%)";
      markActive();
    }

    function placeTabs(){
      // Tabs bleiben immer in selectorZone (desktop) / sticky bottom (mobile) über CSS geregelt
      // (keine DOM-Umsortierung nötig)
    }

    function showGateLogic(){
      // optional: Gate nur anzeigen wenn es in der Page auch einen #shop gibt
      const hasShop = !!document.getElementById("shop");
      if(!hasShop){
        gateZone.style.display = "none";
        return;
      }
      gateZone.style.display = "";
      gateBtn.addEventListener("click", () => {
        document.getElementById("shop")?.scrollIntoView({behavior:"smooth", block:"start"});
      });
    }

    async function load(){
      // Background optional
      const bgManifest = await safeFetchJson(BG_MANIFEST_URL);
      if(bgManifest && Array.isArray(bgManifest.images) && bgManifest.images[0]){
        setBg(bgManifest.images[0]);
      }else{
        // fallback: wenn im HTML bereits per CSS gesetzt wird, nichts tun
      }

      const data = await safeFetchJson(MEMBER_MANIFEST);
      if(data && Array.isArray(data.members) && data.members.length){
        members = data.members;
      }else{
        members = fallbackMembers;
      }

      // Build slides + tabs
      trackEl.innerHTML = "";
      tabsEl.innerHTML = "";

      members.forEach((m, idx) => {
        trackEl.appendChild(buildSlide(m));
        tabsEl.appendChild(buildTab(m, idx));
      });

      goTo(0);
      placeTabs();
      showGateLogic();

      mqMobile.addEventListener?.("change", () => placeTabs());
      window.addEventListener("resize", () => placeTabs());
    }

    load().catch(() => {});
  })();
</script>

</section>
