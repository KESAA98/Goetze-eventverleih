<!-- backend/head.html -->
<style>
  :root{
    --edge-left:  calc(var(--title-pad-x,72px) + var(--logo-pad-left,32px));
    --edge-right: calc(var(--title-pad-x,72px) + var(--nav-pad-right,32px));
    --radius: 18px;
    --shadow-soft: 0 14px 44px rgba(0,0,0,.14);
    --shadow-card: 0 10px 26px rgba(0,0,0,.10);
    --ink: #0f172a;
    --muted: #475569;
    --line: rgba(15,23,42,.10);
    --glass: rgba(255,255,255,.78);
    --glass-2: rgba(255,255,255,.86);
  }

  .head-wrap{
    width:100%;
    padding-left:  var(--edge-left);
    padding-right: var(--edge-right);
    padding-top:  22px;
    padding-bottom: 22px;
  }

  .hero{
    width:100%;
    height: min(62vh, 640px);
    min-height: 420px;
    border-radius: var(--radius);
    overflow:hidden;
    position:relative;
    background:#d9dde3;
    box-shadow: var(--shadow-soft);
  }

  .hero-bg{
    position:absolute; inset:0;
    background-position:center;
    background-size:cover;
    filter:saturate(1.05);
    transform: scale(1.02);
  }
  .hero-overlay{
    position:absolute; inset:0;
    background:
      radial-gradient(1200px 600px at 20% 70%, rgba(255,255,255,.85), rgba(255,255,255,.15) 55%, rgba(0,0,0,.16) 100%),
      linear-gradient(90deg, rgba(255,255,255,.65), rgba(255,255,255,.08) 60%, rgba(0,0,0,.10));
    pointer-events:none;
  }

  .hero-inner{
    position:absolute; inset:0;
    display:grid;
    grid-template-columns: 1.15fr .85fr;
    gap: 22px;
    padding: 26px;
    align-items: stretch;
  }

  .hero-copy{
    display:flex;
    flex-direction:column;
    justify-content:flex-end;
    padding: 14px 6px 6px 6px;
    max-width: 680px;
  }
  .badge{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding: 10px 14px;
    border-radius: 999px;
    background: var(--glass);
    border: 1px solid var(--line);
    width: fit-content;
    color: var(--ink);
    font-weight: 650;
    box-shadow: 0 10px 24px rgba(0,0,0,.08);
    margin-bottom: 14px;
    backdrop-filter: blur(10px);
  }
  .dot{
    width:10px; height:10px; border-radius:999px;
    background:#22c55e;
    box-shadow: 0 0 0 5px rgba(34,197,94,.18);
  }
  h1.hero-title{
    margin:0;
    color: var(--ink);
    font-size: clamp(34px, 4vw, 54px);
    line-height: 1.02;
    letter-spacing: -0.02em;
  }
  .hero-sub{
    margin: 12px 0 18px 0;
    color: var(--muted);
    font-size: 16px;
    line-height: 1.45;
    max-width: 56ch;
  }

  .hero-cta{
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .btn{
    appearance:none;
    border:0;
    cursor:pointer;
    padding: 12px 16px;
    border-radius: 999px;
    font-weight: 650;
    font-size: 14px;
    display:inline-flex;
    align-items:center;
    gap:10px;
    transition: transform .12s ease, filter .12s ease;
  }
  .btn:active{ transform: translateY(1px); }
  .btn-primary{
    background: #0b1220;
    color: white;
    box-shadow: 0 16px 30px rgba(0,0,0,.16);
  }
  .btn-ghost{
    background: var(--glass);
    color: var(--ink);
    border: 1px solid var(--line);
    backdrop-filter: blur(10px);
  }

  .hero-right{
    display:flex;
    flex-direction:column;
    gap: 12px;
  }

  .panel{
    background: var(--glass-2);
    border: 1px solid var(--line);
    border-radius: 18px;
    box-shadow: var(--shadow-card);
    overflow:hidden;
    backdrop-filter: blur(10px);
  }
  .panel-h{
    padding: 12px 14px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    border-bottom: 1px solid rgba(15,23,42,.08);
    color: var(--ink);
    font-weight: 750;
  }
  .panel-h small{
    font-weight:600;
    color: var(--muted);
  }

  .grid6{
    padding: 12px;
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
  }
  .tile{
    aspect-ratio: 1/1;
    border-radius: 14px;
    overflow:hidden;
    background: #e9edf3;
    border: 1px solid rgba(15,23,42,.10);
    position:relative;
  }
  .tile img{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit: cover;
  }

  /* TEAM inside hero */
  .team-strip{
    position:absolute;
    left: 26px;
    right: 26px;
    bottom: 26px;
    display:flex;
    gap: 12px;
    align-items: stretch;
    pointer-events:none; /* keep hero scroll behavior clean */
  }
  .team-card{
    pointer-events:auto;
    flex: 1 1 0;
    min-width: 0;
    background: rgba(255,255,255,.86);
    border: 1px solid rgba(15,23,42,.10);
    border-radius: 18px;
    box-shadow: var(--shadow-card);
    overflow:hidden;
    backdrop-filter: blur(10px);
    display:grid;
    grid-template-columns: 92px 1fr;
    gap: 12px;
    padding: 12px;
    align-items:center;
  }
  .team-img{
    width: 92px;
    height: 92px;
    border-radius: 14px;
    overflow:hidden;
    background:#e9edf3;
    border: 1px solid rgba(15,23,42,.10);
  }
  .team-img img{
    width:100%;
    height:100%;
    object-fit: cover;
    display:block;
  }
  .team-meta{
    min-width:0;
    display:flex;
    flex-direction:column;
    gap: 6px;
  }
  .team-title{
    font-weight: 800;
    color: var(--ink);
    font-size: 14px;
    line-height: 1.1;
  }
  .team-text{
    color: var(--muted);
    font-size: 12.5px;
    line-height: 1.35;
    display:-webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow:hidden;
  }

  .hero.is-loading .hero-inner,
  .hero.is-loading .team-strip{ opacity: 0; transform: translateY(6px); }
  .hero-inner, .team-strip{ transition: opacity .25s ease, transform .25s ease; }

  @media (max-width: 980px){
    .hero-inner{
      grid-template-columns: 1fr;
      padding: 18px;
    }
    .hero-right{ display:none; }
    .team-strip{
      left: 18px; right: 18px; bottom: 18px;
      flex-direction: column;
    }
    .team-card{ grid-template-columns: 76px 1fr; }
    .team-img{ width:76px; height:76px; }
  }
</style>

<div class="head-wrap">
  <section class="hero is-loading" id="hero">
    <div class="hero-bg" id="heroBg"></div>
    <div class="hero-overlay"></div>

    <div class="hero-inner">
      <div class="hero-copy">
        <div class="badge"><span class="dot"></span> LG Eventverleih</div>
        <h1 class="hero-title">Feiern leicht gemacht.</h1>
        <p class="hero-sub">
          Moderne Ausstattung, saubere Abwicklung, zuverl√§ssiger Aufbau ‚Äì damit du dich um das Wichtigste k√ºmmern kannst.
        </p>

        <div class="hero-cta">
          <button class="btn btn-primary" type="button" data-scroll="shop">üõí Zum Shop</button>
          <button class="btn btn-ghost" type="button" data-scroll="kontakt">‚úâÔ∏è Kontakt</button>
        </div>
      </div>

      <aside class="hero-right">
        <div class="panel">
          <div class="panel-h">‚ú® Beliebte Artikel <small id="popularHint">Zufallsauswahl</small></div>
          <div class="grid6" id="popularGrid">
            <!-- tiles -->
          </div>
        </div>
      </aside>
    </div>

    <div class="team-strip" id="teamStrip">
      <!-- team cards -->
    </div>
  </section>
</div>

<script>
(() => {
  const hero = document.getElementById('hero');
  const heroBg = document.getElementById('heroBg');
  const popularGrid = document.getElementById('popularGrid');
  const teamStrip = document.getElementById('teamStrip');

  const pickRandom = (arr, n) => {
    const a = (arr || []).slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a.slice(0, n);
  };

  const fetchJson = async (url) => {
    const res = await fetch(url, { cache: 'no-store' });
    if (!res.ok) throw new Error(url + ' -> ' + res.status);
    return res.json();
  };

  const preloadImage = (src) => new Promise((resolve) => {
    const img = new Image();
    img.onload = () => resolve(true);
    img.onerror = () => resolve(false);
    img.src = src;
  });

  const firstExistingImage = async (candidates) => {
    for (const src of candidates) {
      const ok = await preloadImage(src);
      if (ok) return src;
    }
    return null;
  };

  const basePath = (p) => {
    // works for repo pages too: use relative paths
    return p.replace(/^\//,'');
  };

  const init = async () => {
    try{
      // Background
      const bgList = await fetchJson('image/hintergrund/manifest.json');
      const bg = (bgList && bgList.length) ? bgList[Math.floor(Math.random()*bgList.length)] : null;
      if (bg){
        const bgUrl = 'image/hintergrund/' + bg;
        await preloadImage(bgUrl);
        heroBg.style.backgroundImage = `url("${bgUrl}")`;
      } else {
        heroBg.style.background = '#d9dde3';
      }

      // Popular items (6 random)
      try{
        const items = await fetchJson('Items/manifest.json');
        const picks = pickRandom(items, 6);
        popularGrid.innerHTML = picks.map(p => `
          <div class="tile">
            <img loading="lazy" alt="" src="${basePath(p)}">
          </div>
        `).join('');
      }catch(e){
        // keep empty quietly
        popularGrid.innerHTML = '';
      }

      // Team strip (max 3)
      const team = await fetchJson('Team/manifest.json');
      const members = (team && team.members) ? team.members : [];
      const top = members.slice(0, 3);

      if (!top.length){
        teamStrip.innerHTML = '';
      } else {
        const cards = [];
        for (let i=0; i<top.length; i++){
          const folder = top[i].folder;
          const idx = i + 1;

          const imgCandidates = [
            `Team/${folder}/image.jpg`,
            `Team/${folder}/image.jpeg`,
            `Team/${folder}/image.png`,
            `Team/${folder}/profil.jpg`,
            `Team/${folder}/profil.png`,
            `Team/${folder}/profile.jpg`,
            `Team/${folder}/profile.png`,
            `Team/${folder}/portrait.jpg`,
            `Team/${folder}/portrait.png`,
            `Team/${folder}/1.jpg`,
            `Team/${folder}/1.png`,
          ];

          const imgSrc = await firstExistingImage(imgCandidates);

          let text = '';
          try{
            const r = await fetch(`Team/${folder}/team.txt`, { cache: 'no-store' });
            if (r.ok) text = (await r.text()).trim();
          }catch(e){}

          cards.push(`
            <article class="team-card" title="${folder}">
              <div class="team-img">
                ${imgSrc ? `<img loading="lazy" alt="" src="${imgSrc}">` : ''}
              </div>
              <div class="team-meta">
                <div class="team-title">Teammitglied ${idx}</div>
                <div class="team-text">${(text || '‚Äî').replace(/[&<>"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s]))}</div>
              </div>
            </article>
          `);
        }
        teamStrip.innerHTML = cards.join('');
      }

      hero.classList.remove('is-loading');
    }catch(err){
      // If something fails, still show hero copy
      hero.classList.remove('is-loading');
      console.warn('Head init failed:', err);
    }
  };

  init();
})();
</script>
