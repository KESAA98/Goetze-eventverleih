<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Eventverleih</title>
  <link rel="icon" type="image/png" href="image/Logo.png" />

  <style>
    :root{
      --cart-width: 360px;
      --title-height: 70px;

      --font-base: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

      --bg: #ffffff;
      --text: #0f172a;
      --muted: #6b7280;

      --radius: 18px;
      --shadow-soft: 0 12px 34px rgba(0,0,0,.14);
      --shadow-header: 0 10px 26px rgba(0,0,0,.12);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--font-base);
      color:var(--text);
      background:var(--bg);
      overflow-y:auto;
    }

    /* Slots: werden mit externen HTML-Dateien befüllt */
    .slot{ display:block; }

    /* Cookie overlay: liegt über allem */
    #cookieOverlay{
      position:fixed;
      inset:0;
      z-index:9999;
      display:none;
    }
    #cookieOverlay.is-visible{ display:block; }

    /* Titel ist fix */
    #title{
      position:fixed;
      top:0; left:0; right:0;
      height:var(--title-height);
      z-index:1000;
      background:rgba(255,255,255,.92);
      backdrop-filter:saturate(140%) blur(10px);
      -webkit-backdrop-filter:saturate(140%) blur(10px);
      border-bottom:1px solid rgba(0,0,0,.06);
      box-shadow:none;
      transition: box-shadow .18s ease;
    }
    #title.is-scrolled{ box-shadow: var(--shadow-header); }

    /* Layout: Content + Cart */
    #layout{
      display:flex;
      width:100%;
      min-height:100vh;
      padding-top: var(--title-height);
    }

    #content{
      flex:1;
      min-width:0;
      padding: 18px 18px 28px 18px;
    }

    /* Head + Shop sind normale Bereiche untereinander (native Scroll) */
    section.page{
      width:100%;
      border-radius: var(--radius);
      overflow:hidden;
      background:#fff;
    }

    #head{
      min-height: calc(100vh - var(--title-height) - 36px);
      margin-bottom: 18px;
      box-shadow: var(--shadow-soft);
      background:#d9dde3; /* Fallback bis head.html geladen ist */
    }

    #shop{
      min-height: calc(100vh - var(--title-height) - 36px);
      box-shadow: var(--shadow-soft);
      background:#eef2f7; /* Fallback bis shop.html geladen ist */
    }

    /* Cart: rechts fest */
    #cart{
      width:var(--cart-width);
      flex:0 0 var(--cart-width);
      position:sticky;
      top: var(--title-height);
      height: calc(100vh - var(--title-height));
      padding: 18px 18px 28px 0;
      align-self:flex-start;
    }

    /* Mobile: Cart ausblenden (später als Drawer/Overlay) */
    @media (max-width: 980px){
      #layout{ display:block; }
      #cart{ display:none; }
      #content{ padding: 14px 14px 22px 14px; }
      #head, #shop{ border-radius: 16px; }
    }
  </style>
</head>

<body>
  <!-- 1) Cookies -->
  <div id="cookieOverlay" class="slot" data-src="backend/cookie.html"></div>

  <!-- 2) Titel -->
  <header id="title" class="slot" data-src="backend/titel.html"></header>

  <!-- 3/4/5) Layout -->
  <div id="layout">
    <div id="content">
      <section id="head" class="slot page" data-src="backend/head.html" aria-label="Head"></section>
      <main id="shop" class="slot page" data-src="backend/shop.html" aria-label="Shop"></main>
    </div>

    <aside id="cart" class="slot" data-src="backend/cart.html" aria-label="Warenkorb"></aside>
  </div>

  <script>
    (function(){
      "use strict";

      async function loadInto(el, url){
        try{
          const res = await fetch(url, { cache: "no-store" });
          if(!res.ok) throw new Error("HTTP " + res.status + " for " + url);
          const html = await res.text();
          el.innerHTML = html;
        }catch(err){
          console.error("Load failed:", url, err);
          // Fallback: nichts erzwingen – Seite bleibt bedienbar
        }
      }

      function setCookie(name, value, days){
        const d = new Date();
        d.setTime(d.getTime() + days*24*60*60*1000);
        document.cookie = name + "=" + encodeURIComponent(value) + ";expires=" + d.toUTCString() + ";path=/;SameSite=Lax";
      }
      function getCookie(name){
        const m = document.cookie.match(new RegExp("(^| )" + name + "=([^;]+)"));
        return m ? decodeURIComponent(m[2]) : null;
      }

      function updateTitleShadow(){
        const t = document.getElementById("title");
        if(!t) return;
        if(window.scrollY > 2) t.classList.add("is-scrolled");
        else t.classList.remove("is-scrolled");
      }

      // Soft API für andere Komponenten (falls du Buttons/Links nutzt)
      function scrollToSection(id){
        const target = document.getElementById(id);
        if(!target) return;

        const y = target.getBoundingClientRect().top + window.scrollY - (parseInt(getComputedStyle(document.documentElement).getPropertyValue("--title-height")) || 70) - 10;
        window.scrollTo({ top: Math.max(0, y), behavior: "smooth" });
      }
      window.goShop = () => scrollToSection("shop");
      window.goHead = () => scrollToSection("head");

      async function boot(){
        // Grundgerüst immer laden
        await Promise.all([
          loadInto(document.getElementById("title"), document.getElementById("title").dataset.src),
          loadInto(document.getElementById("head"),  document.getElementById("head").dataset.src),
          loadInto(document.getElementById("shop"),  document.getElementById("shop").dataset.src),
          loadInto(document.getElementById("cart"),  document.getElementById("cart").dataset.src)
        ]);

        // Cookie Overlay nur bei Bedarf
        const accepted = getCookie("cookies_accepted") === "yes";
        if(!accepted){
          const overlay = document.getElementById("cookieOverlay");
          overlay.classList.add("is-visible");
          await loadInto(overlay, overlay.dataset.src);

          // Optionaler Helfer: cookie.html kann window.acceptCookies() aufrufen
          window.acceptCookies = () => {
            setCookie("cookies_accepted","yes",180);
            overlay.classList.remove("is-visible");
          };
        }

        updateTitleShadow();
        window.addEventListener("scroll", updateTitleShadow, { passive:true });
        window.addEventListener("resize", updateTitleShadow, { passive:true });
      }

      boot().catch(err => console.error(err));
    })();
  </script>
</body>
</html>
