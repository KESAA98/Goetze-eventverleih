<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Eventverleih</title>
  <link rel="icon" type="image/png" href="image/Logo.png" />

  <style>
    :root{
      --cart-width: 360px;
      --title-height: 70px;

      --font-base: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

      --bg: #ffffff;
      --shadow-header: 0 10px 26px rgba(0,0,0,.12);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family:var(--font-base);
      background:var(--bg);
      overflow:hidden; /* Stage-Prinzip */
    }

    /* Header / Titel */
    #title{
      position:fixed;
      top:0; left:0; right:0;
      height:var(--title-height);
      z-index:1000;
      background:rgba(255,255,255,.92);
      backdrop-filter:saturate(140%) blur(10px);
      -webkit-backdrop-filter:saturate(140%) blur(10px);
      border-bottom:1px solid rgba(0,0,0,.06);
      box-shadow:none;
      transition: box-shadow .18s ease;
    }
    #title.is-scrolled{ box-shadow: var(--shadow-header); }

    /* Layout */
    #layout{
      position:fixed;
      top: var(--title-height);
      left:0; right:0;
      height: calc(100vh - var(--title-height));
      display:flex;
      width:100%;
    }

    /* STAGE – KEIN Padding! */
    #stage{
      flex:1;
      min-width:0;
      height:100%;
      padding:0;              /* <<< WICHTIG */
      overflow:hidden;
    }

    /* Panels */
    #panels{
      width:100%;
      height:200%;
      transform: translateY(0%);
      transition: transform .38s ease;
      will-change: transform;
    }
    #panels.is-shop{ transform: translateY(-50%); }

    .panel{
      height:50%;
      width:100%;
      overflow:hidden;
      background: transparent; /* Head zeichnet selbst */
    }

    /* Cart */
    #cart{
      width:var(--cart-width);
      flex:0 0 var(--cart-width);
      height:100%;
    }

    @media (max-width: 980px){
      #layout{ display:block; }
      #cart{ display:none; }
    }
  </style>
</head>

<body>
  <header id="title" data-src="backend/titel.html"></header>

  <div id="layout">
    <div id="stage">
      <div id="panels">
        <section id="head" class="panel" data-src="backend/head.html"></section>
        <main id="shop" class="panel" data-src="backend/shop.html"></main>
      </div>
    </div>

    <aside id="cart" data-src="backend/cart.html"></aside>
  </div>

  <script>
    (function(){
      const panels = document.getElementById("panels");
      const headEl = document.getElementById("head");
      const shopEl = document.getElementById("shop");
      const titleEl = document.getElementById("title");

      let active = "head";
      let switching = false;

      async function loadInto(el){
        const res = await fetch(el.dataset.src, { cache:"no-store" });
        el.innerHTML = await res.text();

        /* inline scripts ausführen */
        el.querySelectorAll("script").forEach(old=>{
          const s = document.createElement("script");
          s.text = old.text;
          old.replaceWith(s);
        });
      }

      function getScroller(){
        return active === "head"
          ? (headEl.querySelector(".team-scroll") || headEl)
          : (shopEl.querySelector(".shop-scroll") || shopEl);
      }

      function updateShadow(){
        const sc = getScroller();
        if(sc && sc.scrollTop > 2) titleEl.classList.add("is-scrolled");
        else titleEl.classList.remove("is-scrolled");
      }

      function goShop(){
        if(switching || active==="shop") return;
        switching = true;
        active = "shop";
        panels.classList.add("is-shop");
        setTimeout(()=>{ switching=false; updateShadow(); }, 420);
      }
      function goHead(){
        if(switching || active==="head") return;
        switching = true;
        active = "head";
        panels.classList.remove("is-shop");
        setTimeout(()=>{ switching=false; updateShadow(); }, 420);
      }

      window.goShop = goShop;
      window.goHead = goHead;

      function atBottom(el){
        return el.scrollTop + el.clientHeight >= el.scrollHeight - 2;
      }
      function atTop(el){
        return el.scrollTop <= 0;
      }

      function onWheel(e){
        if(switching) return;
        const sc = getScroller();
        if(!sc) return;

        if(active==="head" && e.deltaY>0 && atBottom(sc)){
          e.preventDefault(); goShop();
        }
        if(active==="shop" && e.deltaY<0 && atTop(sc)){
          e.preventDefault(); goHead();
        }
      }

      let y0=null;
      function onTouchStart(e){ y0=e.touches[0].clientY; }
      function onTouchMove(e){
        if(y0===null||switching) return;
        const dy = e.touches[0].clientY - y0;
        const sc = getScroller();
        if(active==="head" && dy<-28 && atBottom(sc)){ y0=null; goShop(); }
        if(active==="shop" && dy>28 && atTop(sc)){ y0=null; goHead(); }
      }
      function onTouchEnd(){ y0=null; }

      async function boot(){
        await Promise.all([
          loadInto(titleEl),
          loadInto(headEl),
          loadInto(shopEl),
          loadInto(document.getElementById("cart")),
        ]);

        document.getElementById("stage").addEventListener("wheel", onWheel, {passive:false});
        document.getElementById("stage").addEventListener("touchstart", onTouchStart, {passive:true});
        document.getElementById("stage").addEventListener("touchmove", onTouchMove, {passive:false});
        document.getElementById("stage").addEventListener("touchend", onTouchEnd, {passive:true});

        const hs = headEl.querySelector(".team-scroll");
        const ss = shopEl.querySelector(".shop-scroll");
        if(hs) hs.addEventListener("scroll", updateShadow, {passive:true});
        if(ss) ss.addEventListener("scroll", updateShadow, {passive:true});
      }

      boot();
    })();
  </script>
</body>
</html>
